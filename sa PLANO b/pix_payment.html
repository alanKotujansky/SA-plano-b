<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pagamento Pix - SensorLink</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .pix-page{padding:48px 0}
    .pix-grid{display:grid;grid-template-columns:360px 1fr;gap:32px;align-items:start;max-width:1100px;margin:0 auto}
    .qr-box{background:#fff;padding:18px;border-radius:8px;border:1px solid #eee;display:flex;align-items:center;justify-content:center}
    .qr-img{width:320px;height:320px}
    .pix-info h1{font-size:34px;text-align:center;margin-bottom:18px}
    .pix-card{border-radius:8px;border:1px solid #eee;padding:18px;margin-bottom:12px}
    .pix-code{background:#f6f8fb;border-radius:6px;padding:12px;font-family:monospace;color:#0a3a66;overflow:auto}
    .countdown{color:#666;margin-top:8px}
    .copy-btn{background:transparent;border:0;color:var(--blue-3);cursor:pointer;margin-left:8px}
    .pix-actions{display:flex;gap:12px;margin-top:18px}
    .pix-ok{background:var(--blue-2);color:#fff;padding:10px 14px;border-radius:6px;border:0;cursor:pointer}
    .pix-back{background:#f0f0f0;color:#333;padding:10px 14px;border-radius:6px;border:0;cursor:pointer}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="logo">Sensor<span>Link</span></div>
      <nav class="main-nav">
        <a class="nav-link" href="index.html">In칤cio</a>
        <a class="nav-link" href="products.html">Produtos</a>
        <div class="nav-cart-container">
          <a class="nav-link" href="checkout.html">游 Carrinho</a>
          <span class="cart-badge" id="cartBadge">0</span>
        </div>
        <a class="nav-link" href="login.html">Entrar</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="container pix-page">
      <div class="pix-info">
        <h1 id="pixTitle">Pagamento pendente</h1>
      </div>

      <div class="pix-grid">
        <div class="qr-box">
          <img id="qrImage" class="qr-img" src="https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=PIX-CODE-SAMPLE" alt="QR Code Pix">
        </div>

        <div>
          <div class="pix-card">
            <strong>Pedido: <a id="orderId" href="#">#-----</a></strong>
            <div class="countdown">O pagamento ir치 expirar em <span id="countdown">20:00</span>.</div>
          </div>

          <div class="pix-card">
            <div style="display:flex;align-items:center;gap:12px">
              <div style="width:48px;height:48px;border-radius:8px;background:var(--blue-1);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700">PX</div>
              <div>
                <div style="font-weight:700">Pix</div>
                <div style="color:#666">Pagamento por Pix</div>
              </div>
              <div style="margin-left:auto;color:#333;font-weight:700" id="amountLabel">R$ 0,00</div>
            </div>
          </div>

          <div class="pix-card">
            <div>Use o <strong>QRcode</strong> ou o <strong>c칩digo copia e cola</strong> abaixo para pagar utilizando o Pix.</div>
            <pre id="pixCode" class="pix-code" style="margin-top:12px">PIX-CODE-SAMPLE</pre>
            <div style="margin-top:8px"><button id="copyCode" class="copy-btn">Copiar c칩digo</button></div>
          </div>

          <div class="pix-card" style="background:#fff8f2;border-color:#ffd9b3;color:#b05b00">
            <strong>Voc칡 est치 com problemas no pagamento via PIX?</strong>
            <div style="margin-top:8px">Clique abaixo para utilizar o processo manual.</div>
            <div style="margin-top:8px"><a href="#" id="manualLink">Clique aqui</a></div>
          </div>

          <div class="pix-actions">
            <button id="btnBack" class="pix-back">Voltar</button>
            <button id="btnPaid" class="pix-ok">J치 paguei</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">춸 2025 SensorLink - Todos os direitos reservados
      <div class="contact">+55 48 XXXXX-XX</div>
    </div>
  </footer>

  <script>
    // Ler info do sessionStorage
    function fmtMoney(v){
      return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    const infoRaw = sessionStorage.getItem('pix_payment_info');
    let info = null;
    try{ info = infoRaw ? JSON.parse(infoRaw) : null; }catch(e){ info = null; }

    const orderIdEl = document.getElementById('orderId');
    const pixCodeEl = document.getElementById('pixCode');
    const qrImage = document.getElementById('qrImage');
    const amountLabel = document.getElementById('amountLabel');
    const pixTitle = document.getElementById('pixTitle');

    // Gerar order id
    const orderId = '#' + Math.floor(Math.random()*90000000 + 10000000);
    if(orderIdEl) orderIdEl.textContent = orderId;
    if(pixTitle) pixTitle.textContent = 'Pagamento ' + orderId + ' pendente';

    let totalItems = 0;
    if(info && info.totalItems) totalItems = info.totalItems;

    // Exemplo: pre칞o fict칤cio por item R$56.90
    const pricePerItem = 56.90;
    const totalValue = (totalItems * pricePerItem) || pricePerItem;
    if(amountLabel) amountLabel.textContent = fmtMoney(totalValue);

    // Gerar c칩digo Pix - exemplo simplificado
    const code = (info && info.fullName ? 'PIX|' + info.fullName : 'PIX') + '|' + orderId + '|' + Date.now();
    if(pixCodeEl) pixCodeEl.textContent = code;

    // Atualizar QR (usa API p칰blica para gerar imagem)
    const qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=' + encodeURIComponent(code);
    if(qrImage) qrImage.src = qrUrl;

    // Copiar c칩digo
    const copyBtn = document.getElementById('copyCode');
    if(copyBtn){
      copyBtn.addEventListener('click', ()=>{
        navigator.clipboard && navigator.clipboard.writeText(code).then(()=>{
          alert('C칩digo copiado para 치rea de transfer칡ncia');
        }).catch(()=>{ alert('N칚o foi poss칤vel copiar automaticamente. Selecione e copie manualmente.'); });
      });
    }

    // Voltar
    const btnBack = document.getElementById('btnBack');
    if(btnBack) btnBack.addEventListener('click', ()=>{ window.location.href = 'checkout.html'; });

    // J치 paguei -> limpar carrinho e redirecionar
    const btnPaid = document.getElementById('btnPaid');
    if(btnPaid){
      btnPaid.addEventListener('click', ()=>{
        // limpar carrinho
        localStorage.removeItem('sl_cart');
        // opcional: salvar confirma칞칚o local
        alert('Obrigado! Pagamento registrado. Seu pedido ' + orderId + ' est치 em processamento.');
        window.location.href = 'index.html';
      });
    }

    // Contador regressivo (20 minutos)
    let secondsLeft = 20 * 60; // 20 minutos
    const countdownEl = document.getElementById('countdown');
    function updateCountdown(){
      const m = Math.floor(secondsLeft/60).toString().padStart(2,'0');
      const s = (secondsLeft%60).toString().padStart(2,'0');
      if(countdownEl) countdownEl.textContent = m + ':' + s;
      if(secondsLeft <= 0){ clearInterval(countdownTimer); if(countdownEl) countdownEl.textContent = '00:00'; }
      secondsLeft--; 
    }
    updateCountdown();
    const countdownTimer = setInterval(updateCountdown, 1000);

    // Atualizar badge do carrinho (se presente)
    try{ const b = document.getElementById('cartBadge'); if(b) b.textContent = JSON.parse(localStorage.getItem('sl_cart')||'[]').length; }catch(e){}
  </script>
</body>
</html>
